name: Telegram Notifications

on:
  pull_request:
    types: [opened, closed]
  issue_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
    - name: Notify on Telegram
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
      run: |
        if [ "${{ github.event_name }}" = "pull_request" ]; then
          if [ "${{ github.event.action }}" = "opened" ]; then
            MESSAGE="üîî –û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π —Ä–µ–∫–≤–µ—Å—Ç: #${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }} –æ—Ç ${{ github.event.pull_request.user.login }}. \n[–ü—Ä–æ—Å–º–æ—Ç—Ä](${{ github.event.pull_request.html_url }})"
          elif [ "${{ github.event.action }}" = "closed" ]; then
            if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
              MESSAGE="‚úÖ –†–µ–∫–≤–µ—Å—Ç #${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }} –ø—Ä–∏–Ω—è—Ç ${{ github.event.pull_request.user.login }}. \n[–ü—Ä–æ—Å–º–æ—Ç—Ä](${{ github.event.pull_request.html_url }})"
            else
              MESSAGE="‚ùå –†–µ–∫–≤–µ—Å—Ç #${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }} –æ—Ç–∫–ª–æ–Ω–µ–Ω ${{ github.event.pull_request.user.login }}. \n[–ü—Ä–æ—Å–º–æ—Ç—Ä](${{ github.event.pull_request.html_url }})"
            fi
          fi
        elif [ "${{ github.event_name }}" = "issue_comment" ]; then
          if [ "${{ github.event.action }}" = "created" ]; then
            COMMENT="${{ github.event.comment.body }}"
            PR_NUMBER=$(echo "$COMMENT" | grep -oE "#[0-9]+")
            if [ -n "$PR_NUMBER" ]; then
              RELATED_PR="$PR_NUMBER"
            else
              RELATED_PR="None"
            fi
            MESSAGE="üí¨ –ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç ${{ github.event.comment.user.login }} –ø–æ —Ä–µ–∫–≤–µ—Å—Ç—É: #$RELATED_PR \n#${{ github.event.issue.number }}: ${{ github.event.comment.body }}"
          fi
        fi
        
        curl -s -X POST "https://api.telegram.org/bot${{ env.TELEGRAM_BOT_TOKEN }}/sendMessage" -d chat_id=$CHAT_ID -d text="$MESSAGE" -d parse_mode="Markdown"
